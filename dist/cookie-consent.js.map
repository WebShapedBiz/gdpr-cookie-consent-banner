{"version":3,"file":"cookie-consent.js","sources":["../src/accessibility.js","../src/cookie.js","../src/consent.js","../src/index.js"],"sourcesContent":["/**\n * The browser user prefers to have reduced motion.\n */\nexport const DETECT_REDUCED_MOTION = '(prefers-reduced-motion)'\nexport function prefersReducedMotion() {\n  return window.matchMedia(DETECT_REDUCED_MOTION).matches\n}\n\n/**\n * User prefers to have a dark appearance.\n */\nexport const DETECT_COLOR_SCHEME_DARK = '(prefers-color-scheme: dark)'\nexport function prefersDarkAppearance() {\n  return window.matchMedia(DETECT_COLOR_SCHEME_DARK).matches\n}\n\n/**\n * User prefers to have a light appearance.\n */\nexport const DETECT_COLOR_SCHEME_LIGHT = '(prefers-color-scheme: light)'\nexport function prefersLightAppearance() {\n  return window.matchMedia(DETECT_COLOR_SCHEME_LIGHT).matches\n}\n\n/**\n * User prefers to have high contrasts.\n *\n * @deprecated https://developer.mozilla.org/en-US/docs/Web/CSS/@media/-ms-high-contrast\n */\nexport const DETECT_HIGH_CONTRAST = '(-ms-high-contrast: active)'\nexport function prefersHighContrast() {\n  return window.matchMedia(DETECT_HIGH_CONTRAST).matches\n}\n","const cookieDefaults = {\n  expires: getExpirationDate(),\n  path: '/',\n}\n\nfunction getCookie(withName) {\n  const value = ('; ' + document.cookie)\n    .split(`; ${withName}=`)\n    .pop()\n    .split(';')\n    .shift()\n  if (!value || value === 'undefined') {\n    return undefined\n  } else if (['true', 'false'].includes(value)) {\n    return value === 'true' ? true : false\n  }\n  return JSON.parse(value)\n}\n\nfunction getAllCookies() {\n  const strings = document.cookie.split('; ')\n  const cookies = strings.map((str) => {\n    const [key, value] = str.split('=')\n    return { key, value }\n  })\n  return cookies\n}\n\nfunction setCookie(withName, andValue, andOptions) {\n  let options = {}\n  options[withName] = JSON.stringify(andValue)\n  options = { ...options, ...cookieDefaults, ...andOptions }\n  options = createCookieString(options)\n  document.cookie = options\n}\n\nfunction removeCookie(withName, andOptions) {\n  let options = {}\n  options[withName] = ''\n  options['max-age'] = 0\n  options['path'] = cookieDefaults.path\n  options = { ...options, ...andOptions }\n  options['expires'] = new Date('1996-06-13')\n  options = createCookieString(options)\n  setCookie(withName, options)\n}\n\nfunction clearCookies(thatMatch, withOptions) {\n  const allCookies = getAllCookies()\n  const regex = new RegExp(`^${thatMatch}`, 'g')\n  allCookies.forEach(({ key }) => {\n    if (key.match(regex)) {\n      removeCookie(key, withOptions)\n    }\n  })\n}\n\nfunction findCookie(thatMatch) {\n  const allCookies = getAllCookies()\n  const regex = new RegExp(`^${thatMatch}`, 'g')\n  const cookie = allCookies.find(({ key }) => regex.test(key))\n  return cookie || null\n}\n\nfunction getExpirationDate(expiringDays = 365) {\n  const expireDate = new Date()\n  expireDate.setTime(expireDate.getTime() + expiringDays * 24 * 60 * 60 * 1000)\n  return expireDate\n}\n\nfunction createCookieString(withOptions) {\n  return Object.keys(withOptions)\n    .map((key) => `${key}=${withOptions[key]}`)\n    .join('; ')\n}\n\nexport { getCookie, getAllCookies, setCookie, removeCookie, findCookie, clearCookies }\nconst CookieService = {\n  getCookie,\n  getAllCookies,\n  setCookie,\n  removeCookie,\n  findCookie,\n  clearCookies,\n}\nexport default CookieService\n","import { prefersReducedMotion } from './accessibility'\nimport { getCookie, setCookie, removeCookie } from './cookie'\n\nconst Event = {\n  ON_ACCEPT: 'onAccept',\n  ON_REJECT: 'onReject',\n  ON_UPDATE: 'onUpdate',\n  ON_VALUE_CHANGED: 'onValueChanged',\n}\n\nexport default class CookieConsent {\n  constructor(options) {\n    const defaultOptions = {\n      name: 'cookie-consent',\n      banner: document.getElementById('cookieconsent'),\n      notice: document.getElementById('cookienotice'),\n      labels: [\n        {\n          name: 'functional',\n          checked: true,\n          onReject: (consent) => {\n            consent.removeCookieOptions()\n          },\n          onAccept: (consent) => {\n            const choices = consent.getChoices()\n            consent.saveCookieOptions({ choices, consented: true })\n          },\n          onUpdate: (_, { choice }) => {\n            console.log('Functional now:', choice)\n          },\n        },\n      ],\n    }\n\n    this.options = { ...defaultOptions, ...options }\n\n    // console.log(this.options)\n\n    if (!this.options.banner || !this.options.notice) {\n      console.error('Can not find required elements!')\n      return undefined // no banner or notice present\n    }\n\n    this.button = {}\n    this.button.reject = this.options.banner.querySelector('.reject')\n    this.button.accept = this.options.banner.querySelector('.accept')\n\n    if (!this.button.reject || !this.button.accept) {\n      console.error('Can not find required buttons!')\n      return undefined // no buttons present\n    }\n\n    this.initEvents()\n\n    const content = this.loadCookieOptions()\n\n    // console.log(JSON.stringify(content, null, 2))\n\n    if (content && content.choices) {\n      this.setChoices(content.choices)\n      this.runEventCircle(content.choices)\n    } else {\n      this.initFields()\n    }\n\n    if (content && content.consented) {\n      this.showElement(this.options.notice)\n    } else {\n      this.showElement(this.options.banner)\n    }\n  }\n\n  initFields() {\n    const choices = this.options.labels.map(({ name, checked }) => ({\n      name: name,\n      value: checked,\n    }))\n    this.setChoices(choices)\n    return choices\n  }\n\n  initEvents() {\n    // TODO: add `onValueChange` => reload if one value is rejected\n\n    this.button.reject.addEventListener('click', () => {\n      const choices = this.initFields() // reset\n      this.saveCookieOptions({ choices, consented: false })\n      this.runEventsFor(choices, Event.ON_REJECT)\n      window.location.reload()\n    })\n\n    this.button.accept.addEventListener('click', () => {\n      const choices = this.getChoices()\n      this.runEventCircle(choices)\n      this.hideElement(this.options.banner)\n      setTimeout(() => {\n        this.showElement(this.options.notice)\n      }, 160)\n    })\n\n    this.options.notice.addEventListener('click', () => {\n      this.saveCookieOptions({ consented: false })\n      this.hideElement(this.options.notice)\n      this.showElement(this.options.banner)\n    })\n  }\n\n  loadCookieOptions() {\n    let content = getCookie(this.options.name)\n    if (!content) return {}\n    return content\n  }\n\n  saveCookieOptions(saveThis) {\n    const oldContent = getCookie(this.options.name)\n    let newContent = { ...oldContent, ...saveThis }\n    setCookie(this.options.name, newContent)\n  }\n\n  removeCookieOptions() {\n    if (getCookie(this.options.name)) {\n      removeCookie(this.options.name)\n    }\n  }\n\n  getChoice(byName) {\n    const node = this.options.banner.querySelector(`.choice [name=\"choice:${byName}\"]`)\n    return node.checked\n  }\n\n  getChoices() {\n    let choices = []\n    this.options.banner.querySelectorAll('.choice input').forEach((node) => {\n      const name = node.getAttribute('name').replace('choice:', '')\n      const value = node.checked\n      choices.push({ name, value })\n    })\n    return choices\n  }\n\n  setChoices(choices) {\n    this.options.banner.querySelectorAll('.choice input').forEach((node) => {\n      const name = node.getAttribute('name').replace('choice:', '')\n      const choice = choices.find((c) => c.name === name)\n      if (choice) {\n        node.checked = choice.value\n      }\n    })\n  }\n\n  showElement(element) {\n    if ('animate' in element && !prefersReducedMotion()) {\n      element\n        .animate([{ opacity: 0 }, { opacity: 1 }], {\n          duration: 320,\n          iterations: 1,\n        })\n        .addEventListener('finish', function onFinish() {\n          element.classList.add('visible')\n          element.removeEventListener('finish', onFinish)\n        })\n    } else {\n      element.classList.add('visible')\n    }\n  }\n\n  hideElement(element) {\n    if ('animate' in element && !prefersReducedMotion()) {\n      element\n        .animate([{ opacity: 1 }, { opacity: 0 }], {\n          duration: 160,\n          iterations: 1,\n        })\n        .addEventListener('finish', function onFinish() {\n          element.classList.remove('visible')\n          element.removeEventListener('finish', onFinish)\n        })\n    } else {\n      element.classList.remove('visible')\n    }\n  }\n\n  runEventFor(handler, withEvent) {\n    if (handler) {\n      if (handler[withEvent]) {\n        handler[withEvent](this)\n      }\n\n      if (handler[Event.ON_UPDATE]) {\n        const params = {\n          choice: this.getChoice(handler.name),\n        }\n        handler[Event.ON_UPDATE](this, params)\n      }\n    }\n  }\n\n  runEventsFor(loop, withEvent) {\n    loop.forEach(({ name }) => {\n      const handler = this.options.labels.find(({ name: lName }) => lName === name)\n      this.runEventFor(handler, withEvent)\n    })\n  }\n\n  runEventCircle(choices) {\n    choices.forEach(({ name, value }) => {\n      const handler = this.options.labels.find(({ name: lName }) => lName === name)\n      if (value) {\n        this.runEventFor(handler, Event.ON_ACCEPT)\n      } else {\n        this.runEventFor(handler, Event.ON_REJECT)\n      }\n    })\n  }\n}\n","import CookieConsent from './consent'\nimport CookieService from './cookie'\n\nimport './style.scss'\n\nCookieConsent.cookieService = CookieService\n\nexport default CookieConsent\n"],"names":["const","DETECT_REDUCED_MOTION","prefersReducedMotion","window","matchMedia","matches","cookieDefaults","expires","expiringDays","expireDate","Date","setTime","getTime","getExpirationDate","path","getCookie","withName","value","document","cookie","split","pop","shift","includes","JSON","parse","getAllCookies","map","str","setCookie","andValue","andOptions","options","stringify","createCookieString","Object","removeCookie","withOptions","keys","key","join","CookieService","thatMatch","allCookies","regex","RegExp","find","ref","test","forEach","match","CookieConsent","constructor","defaultOptions","banner","getElementById","notice","onReject","consent","removeCookieOptions","onAccept","choices","getChoices","saveCookieOptions","_","log","this","button","reject","querySelector","accept","initEvents","content","loadCookieOptions","setChoices","runEventCircle","initFields","showElement","consented","console","error","labels","addEventListener","runEventsFor","location","reload","hideElement","name","saveThis","oldContent","newContent","getChoice","byName","checked","querySelectorAll","node","getAttribute","replace","push","choice","c","element","animate","onFinish","classList","add","removeEventListener","remove","runEventFor","handler","withEvent","params","loop","cookieService"],"mappings":"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"}