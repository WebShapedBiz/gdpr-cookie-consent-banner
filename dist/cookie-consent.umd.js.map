{"version":3,"file":"cookie-consent.umd.js","sources":["../src/lib/accessibility.js","../src/lib/cookie.js","../src/lib/consent.js","../src/lib/index.js"],"sourcesContent":["/**\n * The browser user prefers to have reduced motion.\n */\nexport const DETECT_REDUCED_MOTION = '(prefers-reduced-motion)'\nexport function prefersReducedMotion() {\n  return window.matchMedia(DETECT_REDUCED_MOTION).matches\n}\n\n/**\n * User prefers to have a dark appearance.\n */\nexport const DETECT_COLOR_SCHEME_DARK = '(prefers-color-scheme: dark)'\nexport function prefersDarkAppearance() {\n  return window.matchMedia(DETECT_COLOR_SCHEME_DARK).matches\n}\n\n/**\n * User prefers to have a light appearance.\n */\nexport const DETECT_COLOR_SCHEME_LIGHT = '(prefers-color-scheme: light)'\nexport function prefersLightAppearance() {\n  return window.matchMedia(DETECT_COLOR_SCHEME_LIGHT).matches\n}\n\n/**\n * User prefers to have high contrasts.\n *\n * @deprecated https://developer.mozilla.org/en-US/docs/Web/CSS/@media/-ms-high-contrast\n */\nexport const DETECT_HIGH_CONTRAST = '(-ms-high-contrast: active)'\nexport function prefersHighContrast() {\n  return window.matchMedia(DETECT_HIGH_CONTRAST).matches\n}\n","const cookieDefaults = {\n  expires: getExpirationDate(),\n  path: '/',\n}\n\nfunction getCookie(withName) {\n  const value = ('; ' + document.cookie)\n    .split(`; ${withName}=`)\n    .pop()\n    .split(';')\n    .shift()\n  if (!value || value === 'undefined') {\n    return undefined\n  } else if (['true', 'false'].includes(value)) {\n    return value === 'true'\n  }\n  return JSON.parse(value)\n}\n\nfunction getAllCookies() {\n  const strings = document.cookie.split('; ')\n  const cookies = strings.map((str) => {\n    const [key, value] = str.split('=')\n    return { key, value }\n  })\n  return cookies\n}\n\nfunction setCookie(withName, andValue, andOptions) {\n  let options = {}\n  options[withName] = JSON.stringify(andValue)\n  options = { ...options, ...cookieDefaults, ...andOptions }\n  options = createCookieString(options)\n  document.cookie = options\n}\n\nfunction removeCookie(withName, andOptions) {\n  let options = {}\n  options[withName] = ''\n  options['max-age'] = 0\n  options.path = cookieDefaults.path\n  options = { ...options, ...andOptions }\n  options.expires = new Date('1996-06-13')\n  options = createCookieString(options)\n  setCookie(withName, options)\n}\n\nfunction clearCookies(thatMatch, withOptions) {\n  const allCookies = getAllCookies()\n  const regex = new RegExp(`^${thatMatch}`, 'g')\n  allCookies.forEach(({ key }) => {\n    if (key.match(regex)) {\n      removeCookie(key, withOptions)\n    }\n  })\n}\n\nfunction findCookie(thatMatch) {\n  const allCookies = getAllCookies()\n  const regex = new RegExp(`^${thatMatch}`, 'g')\n  const cookie = allCookies.find(({ key }) => regex.test(key))\n  return cookie || null\n}\n\nfunction getExpirationDate(expiringDays = 365) {\n  const expireDate = new Date()\n  expireDate.setTime(expireDate.getTime() + expiringDays * 24 * 60 * 60 * 1000)\n  return expireDate\n}\n\nfunction createCookieString(withOptions) {\n  return Object.keys(withOptions)\n    .map((key) => `${key}=${withOptions[key]}`)\n    .join('; ')\n}\n\nexport { getCookie, getAllCookies, setCookie, removeCookie, findCookie, clearCookies }\nconst CookieService = {\n  getCookie,\n  getAllCookies,\n  setCookie,\n  removeCookie,\n  findCookie,\n  clearCookies,\n  getExpirationDate,\n}\nexport default CookieService\n","import { prefersReducedMotion } from './accessibility'\nimport { getCookie, setCookie, removeCookie } from './cookie'\n\nconst Event = {\n  ON_ACCEPT: 'onAccept',\n  ON_REJECT: 'onReject',\n  ON_UPDATE: 'onUpdate',\n  ON_VALUE_CHANGED: 'onValueChanged',\n}\n\nexport default class CookieConsent {\n  constructor(options) {\n    const defaultOptions = {\n      name: 'cookie-consent',\n      banner: document.getElementById('cookiebanner'),\n      notice: document.getElementById('cookienotice'),\n      labels: [\n        {\n          name: 'functional',\n          checked: true,\n          onReject: (consent) => {\n            consent.removeCookieOptions()\n          },\n          onAccept: (consent) => {\n            const choices = consent.getChoices()\n            consent.saveCookieOptions({ choices, consented: true })\n          },\n          onUpdate: (_, { choice }) => {\n            console.log('Functional now:', choice)\n          },\n        },\n      ],\n    }\n\n    this.options = { ...defaultOptions, ...options }\n\n    // console.log(this.options)\n\n    if (!this.options.banner || !this.options.notice) {\n      console.error('Can not find required elements!')\n      return undefined // no banner or notice present\n    }\n\n    this.button = {}\n    this.button.reject = this.options.banner.querySelector('.reject')\n    this.button.accept = this.options.banner.querySelector('.accept')\n\n    if (!this.button.reject || !this.button.accept) {\n      console.error('Can not find required buttons!')\n      return undefined // no buttons present\n    }\n\n    this.initEvents()\n\n    const content = this.loadCookieOptions()\n\n    // console.log(JSON.stringify(content, null, 2))\n\n    if (content && content.choices) {\n      this.setChoices(content.choices)\n      this.runEventCircle(content.choices)\n    } else {\n      this.initFields()\n    }\n\n    if (content && content.consented) {\n      this.showElement(this.options.notice)\n    } else {\n      this.showElement(this.options.banner)\n    }\n  }\n\n  initFields() {\n    const choices = this.options.labels.map(({ name, checked }) => ({\n      name: name,\n      value: checked,\n    }))\n    this.setChoices(choices)\n    return choices\n  }\n\n  initEvents() {\n    // TODO: add `onValueChange` => reload if one value is rejected\n\n    this.button.reject.addEventListener('click', () => {\n      const choices = this.initFields() // reset\n      this.saveCookieOptions({ choices, consented: false })\n      this.runEventsFor(choices, Event.ON_REJECT)\n      window.location.reload()\n    })\n\n    this.button.accept.addEventListener('click', () => {\n      const choices = this.getChoices()\n      this.runEventCircle(choices)\n      this.hideElement(this.options.banner)\n      setTimeout(() => {\n        this.showElement(this.options.notice)\n      }, 160)\n    })\n\n    this.options.notice.addEventListener('click', () => {\n      this.saveCookieOptions({ consented: false })\n      this.hideElement(this.options.notice)\n      this.showElement(this.options.banner)\n    })\n  }\n\n  loadCookieOptions() {\n    const content = getCookie(this.options.name)\n    if (!content) return {}\n    return content\n  }\n\n  saveCookieOptions(saveThis) {\n    const oldContent = getCookie(this.options.name)\n    const newContent = { ...oldContent, ...saveThis }\n    setCookie(this.options.name, newContent)\n  }\n\n  removeCookieOptions() {\n    if (getCookie(this.options.name)) {\n      removeCookie(this.options.name)\n    }\n  }\n\n  getChoice(byName) {\n    const node = this.options.banner.querySelector(`.choice [name=\"choice:${byName}\"]`)\n    return node.checked\n  }\n\n  getChoices() {\n    const choices = []\n    this.options.banner.querySelectorAll('.choice input').forEach((node) => {\n      const name = node.getAttribute('name').replace('choice:', '')\n      const value = node.checked\n      choices.push({ name, value })\n    })\n    return choices\n  }\n\n  setChoices(choices) {\n    this.options.banner.querySelectorAll('.choice input').forEach((node) => {\n      const name = node.getAttribute('name').replace('choice:', '')\n      const choice = choices.find((c) => c.name === name)\n      if (choice) {\n        node.checked = choice.value\n      }\n    })\n  }\n\n  showElement(element) {\n    if ('animate' in element && !prefersReducedMotion()) {\n      element\n        .animate([{ opacity: 0 }, { opacity: 1 }], {\n          duration: 320,\n          iterations: 1,\n        })\n        .addEventListener('finish', function onFinish() {\n          element.classList.add('visible')\n          element.removeEventListener('finish', onFinish)\n        })\n    } else {\n      element.classList.add('visible')\n    }\n  }\n\n  hideElement(element) {\n    if ('animate' in element && !prefersReducedMotion()) {\n      element\n        .animate([{ opacity: 1 }, { opacity: 0 }], {\n          duration: 160,\n          iterations: 1,\n        })\n        .addEventListener('finish', function onFinish() {\n          element.classList.remove('visible')\n          element.removeEventListener('finish', onFinish)\n        })\n    } else {\n      element.classList.remove('visible')\n    }\n  }\n\n  runEventFor(handler, withEvent) {\n    if (handler) {\n      if (handler[withEvent]) {\n        handler[withEvent](this)\n      }\n\n      if (handler[Event.ON_UPDATE]) {\n        const params = {\n          choice: this.getChoice(handler.name),\n        }\n        handler[Event.ON_UPDATE](this, params)\n      }\n    }\n  }\n\n  runEventsFor(loop, withEvent) {\n    loop.forEach(({ name }) => {\n      const handler = this.options.labels.find(({ name: lName }) => lName === name)\n      this.runEventFor(handler, withEvent)\n    })\n  }\n\n  runEventCircle(choices) {\n    choices.forEach(({ name, value }) => {\n      const handler = this.options.labels.find(({ name: lName }) => lName === name)\n      if (value) {\n        this.runEventFor(handler, Event.ON_ACCEPT)\n      } else {\n        this.runEventFor(handler, Event.ON_REJECT)\n      }\n    })\n  }\n}\n","import CookieConsent from './consent'\nimport CookieService from './cookie'\n\nimport '../style.scss'\n\nCookieConsent.cookieService = CookieService\n\nexport default CookieConsent\n"],"names":["const","DETECT_REDUCED_MOTION","prefersReducedMotion","window","matchMedia","matches","cookieDefaults","expires","getExpirationDate","path","getCookie","withName","value","document","cookie","split","pop","shift","includes","JSON","parse","getAllCookies","map","str","setCookie","andValue","andOptions","options","stringify","createCookieString","Object","removeCookie","Date","expiringDays","expireDate","setTime","getTime","withOptions","keys","key","join","CookieService","thatMatch","allCookies","regex","RegExp","find","test","forEach","match","CookieConsent","constructor","defaultOptions","name","banner","getElementById","notice","labels","checked","onReject","consent","removeCookieOptions","onAccept","choices","getChoices","saveCookieOptions","consented","onUpdate","_","console","log","this","button","reject","querySelector","accept","initEvents","content","loadCookieOptions","setChoices","runEventCircle","initFields","showElement","error","addEventListener","runEventsFor","location","reload","hideElement","setTimeout","saveThis","oldContent","newContent","getChoice","byName","querySelectorAll","node","getAttribute","replace","push","choice","c","element","animate","opacity","duration","iterations","onFinish","classList","add","removeEventListener","remove","runEventFor","handler","withEvent","params","loop","cookieService"],"mappings":"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"}